<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.example.server.mapper.CourseMapper">
    <select id="selectAll">
        SELECT * , course_type.course_type_name
            FROM Course
            JOIN course_type ON course.course_type_id = course_type.id;
    </select>
    <select id="selectAllByPage">
        SELECT * , course_type.course_type_name
        FROM Course
                 JOIN course_type ON course.course_type_id = course_type.id
            limit (#{pageNum}) * 6,6;
    </select>
    <select id="selectInfo" resultType="org.example.server.pojo.Course">
        SELECT * FROM course where id = #{id};
    </select>
    <select id="selectByNum" resultType="org.example.server.pojo.Course">
        SELECT * FROM Course where num = #{num};
    </select>
    <update id="updateInfo">
        update Course
        <set>
            <if test="course_name !=null and course_name!=''">course_name=#{course_name},</if>
            <if test="credit !=null">credit=#{credit},</if>
            <if test="num !=null">num=#{num},</if>
            <if test="course_type_id!=null">course_type_id=#{course_type_id},</if>
            <if test="book !=null">book=#{book},</if>
            <if test="extracurricular!=null">extracurricular=#{extracurricular},</if>
            <if test="teacher!=null">teacher_name=#{teacher},</if>
            <if test="classes!=null">classes=#{classes}</if>
        </set>
        where id = #{id};
    </update>
    <insert id="addCourse" parameterType="org.example.server.pojo.Course">
        insert into Course (course_name,credit,num,course_type_id,pre_course_id,book,extracurricular,classes,teacher_name,terms) values (#{course_name},#{credit},#{num},#{course_type_id},#{pre_course_id},#{book},#{extracurricular},#{classes},#{teacher_name},#{terms});
    </insert>
    <delete id="deleteCourseById" parameterType="org.example.server.pojo.Course">
        delete from Course where id = #{id};
    </delete>
    <select id="selectMixed" resultType="org.example.server.pojo.Course">
        select * from Course
        <where>
            <if test="course_name != null">
                and course_name like #{course_name}
            </if>
            <if test="course_type_id != null">
                and course_type_id = #{course_type_id}
            </if>
        </where>
        limit #{pageNum} * 2,2;
    </select>
    <select id="selectCourseByName" resultType="org.example.server.pojo.Course">
        SELECT * FROM Course where course_name = #{course_name};
    </select>
    <select id="selectIdByStudent">
        SELECT course.course_name
        FROM student
                 JOIN student_course ON student.id = student_course.student_id
                 JOIN course ON student_course.course_id = course.id
        WHERE student.id = #{student_id};
    </select>
    <select id="selectLessonByStudent">
        SELECT course.course_name,course.teacher_name,lesson.time_sort,lesson.room,lesson.week_time
        FROM student
                 JOIN student_course ON student.id = student_course.student_id
                 JOIN course ON student_course.course_id = course.id
                 JOIN lesson ON student_course.course_id = lesson.course_id
        WHERE student.id = #{student_id} and lesson.week = #{week} and lesson.terms = #{terms};
    </select>
    <select id="selectType">
        SELECT course_type.course_type_name
        FROM course
                 JOIN course_type ON course.course_type_id = course_type.id
        WHERE course.id = #{course_id};
    </select>
    <select id="selectAllType">
        SELECT course_type_name from course_type;
    </select>
    <select id="selectSpecial">
        select * , course_type.course_type_name
        from Course
        JOIN course_type ON course.course_type_id=course_type.id
        <where>
            <if test="course_name != null">
                and course_name LIKE '%' || #{course_name} || '%'
            </if>
            <if test="course_type_id != null">
                and course_type_id = #{course_type_id}
            </if>
            <if test="terms != null">
                and terms = #{terms}
            </if>
            <if test="num != null">
                and num like '%' || #{num} || '%'
            </if>
            <if test="classes != null">
                and classes like '%' || #{classes} || '%'
            </if>
        </where>
        <if test="pageNum != null">
            limit (#{pageNum}) * 6,6;
        </if>
    </select>
    <delete id="deleteCourse">
        delete from course where id = #{id};
    </delete>
    <select id="selectStudentCourse">
        SELECT *,course.teacher_name
        FROM student_course
        JOIN course ON student_course.course_id = course.id
        WHERE student_course.course_id = #{id};
    </select>



</mapper>